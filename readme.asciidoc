== MongoDB Metrics Storage Engine ==

This project provides a storage engine based on MongoDB for timeseries event data stream. Metrics (min, max, avg, sum) are calculated periodically and stored separately from the event data stream.

=== Requirements: ===
* Apache Maven version 3
* Spring Data MongoDB 1.4.0.M1
* MongoDB 2.0.7 or later

=== Building: ===
image::https://travis-ci.org/aparnachaudhary/mongodb-metrics-store.png?branch=master["Build Status", link="https://travis-ci.org/aparnachaudhary/mongodb-metrics-store"]

image::https://coveralls.io/repos/aparnachaudhary/mongodb-metrics-store/badge.png?branch=master["Build Status", link="https://coveralls.io/r/aparnachaudhary/mongodb-metrics-store?branch=master"]
To build, issue this from the command line:
[source]
----
mvn clean install
----

=== How it works: ===

==== Gauge Event ====

Event data stream is represented as +GaugeEvent+. Event can be represented in the form of following JSON structure. Gauge event has a +value+ field stored as +double+ and optionally context data can be stored in the form of map construct. Events are stored in their separate collections.
e.g. for event with name 'request'; a collection with name +request_gauge_events+ is created in the +eventstore+ database.

[source, js]
----
{
    "_id" : ObjectId("52bede0cc2e6f68c4ad8b7a6"),
    "_class" : "net.arunoday.kpi.engine.entity.GaugeEventEntity",
    "occuredOn" : ISODate("2013-12-28T14:19:56Z"),
    "eventType" : "request",
    "value" : 1,
    "contextData" : {
        "index" : 1
    }
}
----

==== Gauge Metric ====

Metrics (min, max, avg, sum) are calculated based on the event input. Metrics are calculated using hierarchial aggregations. 

Following aggregations are supported:

* Minute-wise
* Hourly
* Daily
* Monthly
* Yearly

For each event type; aggregation results are stored in separate collections in +metricstore+ database. e.g. +request.minute+ +request.hourly+ +request.daily+ +request.monthly+ and +request.yearly+


[source, js]
----
{
    "_id" : ISODate("2013-12-28T13:56:00Z"),
    "value" : {
        "total" : 7170,
        "count" : 12,
        "min" : 0,
        "max" : 603,
        "mean" : 597.5,
        "ts" : ISODate("2013-12-28T13:57:00Z")
    }
}
----

=== Licensing and Copyright: ===

The project is licensed under the http://www.apache.org/licenses/LICENSE-2.0[Apache License, Version 2.0]
